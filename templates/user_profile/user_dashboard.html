{% extends 'base.html' %}
{% load static %}
{% block title %} User Dashboard {% endblock title %}

{% block content %}
<div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-left">
                <div class="profile-avatar-large">
                    {% if user.profile_picture %}
                    <img src={{user.profile_picture.url}} alt={{user.first_name}} />
                    {% else %}
                    {{user.first_name|first|upper}}
                    {% endif %}
                </div>
                <div class="user-info">
                    <h1>{{user.first_name}} {{user.last_name}}</h1>
                    <div class="user-meta">
                        <span>{{user.student_id}}</span>
                        <span>🏛️ {{user.university}}</span>
                        <span>📚 {{user.department}}</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" onclick="window.location.href='{% url 'settings'%}'">⚙️ Settings</button>
                <button class="btn btn-primary" onclick="window.location.href='{% url 'edit_user' user.slug %}'">✏️ Edit Profile</button>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-box-icon">⭐</div>
                <div class="stat-box-value">{{review.count}}</div>
                <div class="stat-box-label">Reviews Given</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">💾</div>
                <div class="stat-box-value">{{saved_crs.count}}</div>
                <div class="stat-box-label">Saved CRs</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">👁️</div>
                <div class="stat-box-value">156</div>
                <div class="stat-box-label">Profile Views</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">🏆</div>
                <div class="stat-box-value">Gold</div>
                <div class="stat-box-label">Member Status</div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- My Reviews -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">📝 My Reviews</h2>
                    {% comment %} <a href="#" class="card-link">View All →</a> {% endcomment %}
                </div>
                {% for review in review %}
                <div class="review-item">
                    <div class="review-header">
                        <div class="review-cr">
                            <div class="cr-avatar">A</div>
                            <div class="cr-info">
                                <h4>{{review.cr_profile.name}}</h4>
                                <p>{{review.cr_profile.university}} • {{review.cr_profile.department}}</p>
                            </div>
                        </div>
                        <div class="rating">
                            {% for i in "12345" %} {% if forloop.counter <= review.rating %}
                            <span class="star filled">★</span>
                            {% else %}
                            <span class="star">☆</span>
                            {% endif %} {% endfor %}
                        </div>
                    </div>
                    <div class="review-text">
                        "{{review.description}}"
                    </div>
                    <div class="review-actions">
                        <button class="action-btn edit">✏️ Edit</button>
                        <button class="action-btn delete">🗑️ Delete</button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Sidebar -->
            <div>
                <!-- Recent Activity -->
                <div class="dashboard-card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2 class="card-title">🔔 Recent Activity</h2>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">⭐</div>
                        <div class="activity-content">
                            <h4>Review Submitted</h4>
                            <p>You reviewed {{last.cr_profile.name}}</p>
                            <div class="activity-time">{{last.created_at}}</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">💾</div>
                        <div class="activity-content">
                            <h4>CR Saved</h4>
                            <p>You saved {{last_cr_saved.cr_profile.name}}</p>
                            <div class="activity-time">{{last_cr_saved.saved_at}}</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">✏️</div>
                        <div class="activity-content">
                            <h4>Profile Updated</h4>
                            <p>You updated your profile</p>
                            <div class="activity-time">{{user.updated_at}}</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">🔍</div>
                        <div class="activity-content">
                            <h4>Search Performed</h4>
                            <p>You searched for CRs</p>
                            <div class="activity-time">5 days ago</div>
                        </div>
                    </div>
                </div>

                <!-- Saved CRs -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2 class="card-title">💾 Saved CRs</h2>
                        {% comment %} <a href="#" class="card-link">View All →</a> {% endcomment %}
                    </div>

                     {% for save_cr in saved_crs %}
                    <div class="saved-cr-item">
                       
                        <div class="saved-avatar">A</div>
                        <div class="saved-info">
                            <h4>{{save_cr.cr_profile.name}}</h4>
                            <p>{{save_cr.cr_profile.university}}</p>
                        </div>
                        <div class="saved-rating">
                            ⭐ {{save_cr.cr_profile.average_rating}}
                        </div>
                        
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-card full-width-card" style="margin-top: 2rem;">
            <div class="card-header">
                <h2 class="card-title">⚡ Quick Actions</h2>
            </div>
            <div class="settings-grid">
                <div class="setting-item">
                    <div class="setting-icon">🔍</div>
                    <h3>Search CRs</h3>
                    <p>Find and review class representatives from your university</p>
                </div>
                <div class="setting-item">
                    <div class="setting-icon">📝</div>
                    <h3>Write Review</h3>
                    <p>Share your experience with a CR and help other students</p>
                </div>
                <div class="setting-item">
                    <div class="setting-icon">👤</div>
                    <h3>Update Profile</h3>
                    <p>Keep your profile information up to date</p>
                </div>
                <div class="setting-item">
                    <div class="setting-icon">🔔</div>
                    <h3>Notifications</h3>
                    <p>Manage your notification preferences and alerts</p>
                </div>
            </div>
        </div>
    </div> 
    {% include 'rating.html' %} 
{% endblock content %}